# MAMAS — System Instructions

You operate within the **MAMAS (Multi-Adaptive Multi-Agent System)** framework. This file defines your behavior constraints.

## Routing Protocol (Mandatory)

Every incoming task MUST be routed before execution. Never skip routing.

### Step 1: Complexity Assessment

Evaluate the task against these criteria:

- Single-domain, well-defined task with a matching nano specialist → **Direct mode**
- Moderate complexity, single specialist sufficient → **Full specialist mode**
- Requires 3+ specialists, cross-domain integration, or no clear match → **MAMAS mode**

### Step 2: Execute Based on Mode

**Direct mode**: Read the matching nano specialist from `specialists/.nano/` and execute immediately.

**Full specialist mode**: Read the matching full specialist from `specialists/` and execute.

**MAMAS mode**: Read `specialists/planner.md` → Planner produces a playbook → Read `specialists/coordinator.md` → Coordinator executes the playbook by dispatching specialists.

### Step 3: Capability Index (When Keyword Matching Fails)

Read `.claude/experts-index.json` to find matching specialist capabilities. If no match exists → MAMAS mode, which may trigger specialist creation via the Talent Architect.

## Directory Protocol

### `source/` — Raw Materials (User-Managed Input)

- Users place raw materials here: chat logs, meeting notes, reference documents
- Before reading any source file, **always check `source/.meta/summaries/` first**
- If no digest exists, generate one via the Context Synthesizer and cache it in `source/.meta/summaries/`
- Never pass raw source content between specialists — always pass the digest + file path

### `output/` — Deliverables (System-Generated Output)

- All final artifacts are written here
- After producing any output file, **auto-generate a digest** in `output/.meta/summaries/`
- This enables downstream tasks to reference prior deliverables without re-reading them

### `notes/` — Process Workspaces (Isolated)

- Each task gets its own directory: `notes/{task-name}/`
- The **playbook** (`playbook.md`) is the execution plan generated by the Planner
- Intermediate artifacts go in `cache/`; inter-specialist context summaries go in `cache/.context/`
- **Access control**: A task's specialists may ONLY read their own `notes/{task}/` directory. Accessing another task's `cache/` is prohibited.

### `specialists/` — Agent Definitions (Read-Only During Execution)

- Never modify specialist files during task execution
- `.nano/` contains lightweight variants (< 250 tokens) for simple tasks
- The Talent Architect is the only process that creates or modifies specialist definitions

## Token Economy

1. **Digest-first**: Always check cached digests before reading raw files
2. **Summary transfer**: Pass digests + file paths between specialists, never full content
3. **Nano preference**: Use nano specialists for straightforward tasks
4. **Parallel execution**: Run independent specialist tasks concurrently
5. **Cache reuse**: Digests in `source/.meta/` and `output/.meta/` persist across tasks

## Auto-Maintenance Obligations

When the system **reads from `source/`**:
- Check `source/.meta/summaries/{filename}.md`
- If missing or stale → generate digest → write to `source/.meta/summaries/`

When the system **writes to `output/`**:
- Generate digest of the deliverable → write to `output/.meta/summaries/{filename}.md`
- Update `output/.meta/index.json` if it exists

## Self-Evolution Protocol

The Planner evaluates specialist performance after task completion. When quality falls below expectations:

1. Planner flags the specialist for review
2. Talent Architect analyzes the gap and produces an upgraded specialist definition
3. Updated specialist replaces the original in `specialists/`
4. Capability registry (`.claude/experts-index.json`) is updated accordingly

This loop runs continuously: **every task is an opportunity to improve the system**.
